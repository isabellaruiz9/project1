---
title: 'Project 1: Wrangling, Exploration, Visualization'
author: "SDS322E"
date: ''
output:
  html_document:
    toc: yes
    toc_float:
      collapsed: no
      smooth_scroll: yes
  pdf_document:
    toc: no
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, eval = TRUE, fig.align = "center", warning = F, message = F,
tidy=TRUE, tidy.opts=list(width.cutoff=60), R.options=list(max.print=100))
```
  

## Data Wrangling, Exploration, Visualization
  
  
#### Isabella Ruiz imr577
  
  
### Introduction 

  The Peruvian Amazon is remarkable for many reasons, one of these being its terrifying amount of pathogenic microbes. For example, though it is usually rare for major, English-language news sources to report on this region, the Associated Press recently released an article detailing the severity of COVID-19 in Pucallpa, its second-largest city (1). As my family is from Pucallpa, I've heard many anecdotes about the parasites and diseases you can contract in the area; the last time my father went, he reportedly lost 15 pounds in one week from severe food poisoning. Knowing all of this, but being unable to find region-specific data, led me to investigate the occurrence of infectious disease in the entirety of Peru. Of course, examining the magnitude of infectious disease over many years isn't particularly interesting by itself because it tells nothing of the potential reasons for certain trends. While I had many ideas for investigating potential reasons, most were precluded by the lack of longitudinal data concerning Peru. Using what data was available to me brought me to compose my ultimate question: is there an association between infectious disease and CO~2~ emissions (as a measure of energy use) in Peru?  

  The only readily-usable infectious disease data for Peru were five datasets that each contained the annual (around 1970-2019) cases for a single, unique communicable disease; together, these diseases were diphtheria, malaria, yellow fever, tetanus, and measles. These individual datasets were sourced from the World Health Organization (WHO) and the Pan American Health Organization (PAHO), with some missing data being corrected through older reports from the Peruvian Ministry of Health (2-5,6,7). In the combined data set, the amount of cases for each disease will become five variables and the years will become the observations, or rows. As for the other topic of concern, three country-level datasets were obtained from "Our World in Data", a program from the University of Oxford: one for annual CO~2~ emissions in tons, one for annual CO~2~ emissions (tons) per capita, and one for the change in CO~2~ emissions (tons) from the prior year (8). These will be joined to the disease data by year of occurrence, and the three CO~2~ emission measures will become three additional variables in a final dataset. I maybe expect a slight association to form where increased CO~2~ emissions seem to correlate with lower instances of disease as it is generally accepted that, over the years, energy usage rose from increased consumption and cases of infectious disease have gone down due to vaccines and improved cleanliness.


```{R}
library(tidyverse)
diphtheria <- read_csv("~/project1/perudiphtheria.csv")
malaria <- read_csv("~/project1/perumalaria2.csv")
yellowfever <- read_csv("~/project1/peruyellowfever.csv")
tetanus <- read_csv("~/project1/perutetanus.csv")
measles <- read_csv("~/project1/perumeasles.csv")
percapita <- read_csv("~/project1/co-emissions-per-capita.csv")
annual_co2 <- read_csv("~/project1/annual-co2-emissions-per-country.csv")
absolute_change <- read_csv("~/project1/absolute-change-co2.csv")
```

### Tidying: Reshaping

  Each data set was cleaned slightly in order to simplify the joining process. Extraneous columns, such as those that repeatedly listed the location as "Peru", were removed from the "diphtheria","yellowfever","tetanus", "measles", and "measles" datasets for their non-relevance. The "Value" column of each of these sets was renamed to match the disease described by the data. All but the "malaria" dataset, which came from a different source than the others, had a column of years labeled "Period"; this column was renamed to "Year" for each. Because the CO~2~ datasets contained observations for all countries, not just Peru, the observations were filtered to only include the "Entity" Peru. Then, the columns for "Entity" and "Code" were removed from these data frames because they redundantly described the data as pertaining to Peru. The disease datasets were left with two variables (year and the cases per distinct disease), and the CO~2~ datasets were left with a column labeled for year and a column labeled for whatever measurement it contained (either emissions, emissions per capita, or emission change from previous year).

```{R}
diphtheria1 <- diphtheria %>% select(Period,Value) %>% rename(Year="Period", diphtheria="Value")
yellowfever1 <- yellowfever %>% select(Period,Value) %>% rename(Year="Period", yellow_fever="Value")
tetanus1 <- tetanus %>% select(Period,Value) %>% rename(Year="Period", tetanus="Value")
measles1 <- measles %>% select(Period,Value) %>% rename(Year="Period", measles="Value")

malaria %>% select(Year,Value) %>% rename(malaria="Value") -> malaria1

peru_percapita <- percapita %>% filter(Entity=="Peru") %>% select(-Entity,-Code)
peru_annual <- annual_co2 %>% filter(Entity=="Peru") %>% select(-Entity,-Code)
peru_change <- absolute_change %>% filter(Entity=="Peru") %>% select(-Entity,-Code)
```

    
### Joining/Merging
```{R}
dim(diphtheria1)
dim(malaria1) 
dim(tetanus1)
dim(measles1)
dim(yellowfever1)
dim(peru_annual)
dim(peru_percapita)
dim(peru_change)
```
    
  There are 50 rows in the "diphtheria1", "malaria1", "tetanus1", and "measles1" data sets. Both the "peru_annual" and "peru_percapita" datasets have 136 rows. "yellowfever1" has 51 rows, and "peru_change" has 135 rows. All these datasets currently have two variables.

```{R}
diphtheria1 %>% distinct(Year) %>% count
malaria1 %>% distinct(Year) %>% count
tetanus1 %>% distinct(Year) %>% count
measles1 %>% distinct(Year) %>% count
yellowfever1 %>% distinct(Year) %>% count
peru_annual %>% distinct(Year) %>% count
peru_percapita %>% distinct(Year) %>% count
peru_change %>% distinct(Year) %>% count
```
  
  When the ID variable is "Year", there are 51 unique ID values for "diphtheria1", "malaria1", tetanus1", and "measles1" datasets. "yellowfever1" has 51 distinct "Year" values. "peru_annual" and "peru_percapita," have 136 distinct values for "Year", while "peru_change" has only 135 unique values for "Year". This and the previously-calculated number of rows per dataset indicate that there is no redundancy, or repeated "Year" values, *within* the ID variable of each data set.
```{R}
semi_join(diphtheria1,malaria1,by="Year") %>% semi_join(tetanus1,by="Year") %>% semi_join(measles1,by="Year")

semi_join(peru_annual,peru_percapita,by="Year")

semi_join(diphtheria1,peru_annual,by="Year")
semi_join(diphtheria1,yellowfever1,by="Year")
semi_join(diphtheria1,peru_change,by="Year")
semi_join(peru_annual,yellowfever1,by="Year")
semi_join(peru_annual,peru_change,by="Year")
semi_join(yellowfever1,peru_change,by="Year")
```
  
  The "diphtheria1," "malaria1,", "tetanus1," and "measles1" datasets share 50 ID values in common, which is the total amount of rows and unique ID values in each of these datasets, meaning that they include the exact same amount of the exact same years. The years in all of these datasets span from 1970 to 2019, and they can be considered interchangeable or equivalent in future ID variable comparisons. In a similar manner, there are 136 shared ID values in the "peru_annual" and "peru_percapita" datasets, who already share the same amount of rows and unique ID values, meaning that the years included in these two data sets are exactly the same. The years span from 1884 to 2019 in these two datasets, which can again be considered equivocal in future ID variable comparisons. The aforementioned group of 4 disease variables share 50 ID values in common with "yellowfever1","peru_annual", "peru_percapita", and "peru_change", these again being 1970 to 2019. The group consisting of "peru_annual" and "peru_percapita" share 51 ID values in common with "yellowfever1" and 135 ID values in common with "peru_change", which are 1969-2019 and 1885-2019 respectively. Finally, 51 ID values are held in common between "yellowfever1" and "peru_change", with these values being the years 1969 through 2019.

```{R}
anti_join(yellowfever1,diphtheria1,by="Year")
anti_join(peru_change,diphtheria1,by="Year")
anti_join(peru_annual,diphtheria1,by="Year")
anti_join(peru_annual,yellowfever1,by="Year")
anti_join(peru_change,yellowfever1,by="Year")
anti_join(peru_annual,peru_change,by="Year")
```
  
  There is one ID value in the "yellowfever1" dataset that is not in the datasets for the other diseases ("diphtheria1","malaria1","tetanus1","measles1"); this ID value is the year 1969. The years 1884-1969 (86 ID values) are in the "peru_annual" and "peru_percapita" datasets, but not in the datasets for diphtheria, malaria, tetanus, and measles. Similarly, the years 1885-1969 (85 ID values) appear in the "peru_change" dataset but not in the diphtheria, malaria, tetanus, and measles datasets. Years 1884-1968 (85 ID values) appear in the "peru_annual"/"peru_percapita" datasets but not in the "yellowfever1" dataset, and years 1885-1968 (84 ID values) appear in the "peru_change" dataset but not in the "yellowfever1" dataset. The single ID value 1884 can be found in "peru_annual" and "peru_percapita" but not in "peru_change".

```{R}
full_join(diphtheria1,malaria1,by="Year") %>% full_join(tetanus1,by="Year") %>% full_join(measles1,by="Year") %>% left_join(yellowfever1,by="Year") %>% left_join(peru_annual,by="Year") %>% left_join(peru_percapita,by="Year") %>% left_join(peru_change,by="Year") -> peru_combination
dim(peru_combination)
head(peru_combination)
```
  
  Because the "diphtheria1", "malaria1", "tetanus1", and "measles1" datasets had the exact same amount of the exact same ID values, joining these datasets by the variable "Year" would have the exact same output regardless of the join that was used. As it did not really matter, I joined these datasets using multiple full joins. I added the remaining datasets to this merged dataset using left joins because the remaining datasets had values for "Year" which fell outside of the years for the combined "diphtheria1-malaria1-tetanus1-measles1" data. As there would be no diphtheria, malaria, tetanus, or measles data for years outside of their datasets, it did not seem worthwhile to add the data via a full join and produce "Year" rows with many N/As. Theoretically, the join I described could also be facilitated with inner joins to produce the same results; there was no reason I chose left joins over inner joins. The final data set has 50 observations of 9 variables, one of these being the ID "Year" variable. This means that a single row from the "yellowfever1" dataset, 85 rows from the "peru_change" dataset, and 86 rows from both the "peru_annual" and "peru_percapita" datasets were omitted from the final dataset. While dropping these rows may lead to a less-than-comprehensive overview of yellow fever cases and CO2 emissions in Peru over the course of decades, the NA cells that would have been generated were these rows kept would make analysis of these rows vague and inconclusive.

###  Wrangling

```{R}
se <- function(x){
  sd(x,na.rm=T)/sqrt(length(x))
}
```

```{R}
outlier <- function(x){
  y <- vector()
  for(i in 1:length(x)){
    if(x[i] > quantile(x,.75)+1.5*(quantile(x,.75)-quantile(x,.25))) {
      y[i] <- "outlier"
    } else if(x[i] < quantile(x,.25)-1.5*(quantile(x,.75)-quantile(x,.25))) {
      y[i] <- "outlier"
    } else {
      y[i] <- "non-outlier"
    }
  }
  return(y)
}
```

```{R}
type <- function(x){
  z <- vector()
  for(i in 1:length(x)){
    if(x[i]=="diphtheria"|x[i]=="tetanus"){
      z[i] <- "bacterial"
    } else if(x[i]=="yellow_fever"|x[i]=="measles"){
      z[i] <- "viral"
    } else {
      z[i] <- "parasitic"
    }
  }
  return(z)
}
```

```{R}
decade <- function(x){
  w <- vector()
  for(i in 1:length(x)){
    if (1970 <= x[i] & x[i] < 1980){
      w[i] <- "seventies"
    } else if(1980 <= x[i] & x[i] < 1990){
      w[i] <- "eighties"
    } else if(1990 <= x[i] & x[i] < 2000){
      w[i] <- "nineties"
    } else if(2000 <= x[i] & x[i] < 2010){
      w[i] <- "aughts"
    } else {
      w[i] <-"twenty-tens"
    }
  }
  return(w)
}
```

```{R}
century <- function(x){
  d <- vector()
  for(i in 1:length(x)){
    if (x[i]<2000){
      d[i] <- "twentieth century"
    } else {
      d[i] <- "twenty-first century"
    }
  }
  return(d)
}
```

```{R}
rows <- c("diphtheria","malaria","tetanus","measles","yellow fever","total")
rows_CO2 <- c("Annual CO2 emissions (tons)","Annual CO2 emissions (tons per capita)","Annual CO2 emissions growth (tons)")
decade_rows <-c("seventies","eighties","nineties","aughts","twenty-tens")
```
   
    
  The chunks above are the preparation work that I did before generating tables of summary statistics  (which can be seen below). The first five chunk show the functions I wrote for the tables I made: one is to calculate the standard error of the mean ($\frac{\sigma}{\sqrt{N}}$) for a vector; another is to generate a categorical vector of either "outlier" or "non-outlier" for every digit in a numeric vector (based on either $Q_3+1.5(IQR)$ or $Q_1-1.5(IQR)$); the third returns whether a disease is "bacterial", "viral", or "parasitic" according to the categorical disease input (diphtheria and tetanus are caused by bacteria, measles and yellow fever are caused by viruses, and malaria is caused by a parasite); the fourth returns a categorical decade name based on the year input (1970-1979 are the "seventies", 1980-1989 are the "eighties", 1990-1999 are the "nineties", 2000-2009 are the "aughts", and 2010-2019 are the "twenty-tens"); and the last creates a vector of categorical century based on the numeric year vector input (either "twentieth" or "twenty-first"). The sixth chunk includes vectors of strings used to rearrange rows by a categorical variable rather than a numeric variable as is typical.
  
```{R}
peru_combination %>% group_by(Year) %>% mutate(total=sum(diphtheria,malaria,yellow_fever,tetanus,measles,na.rm=T)) %>% pivot_longer(c(2,3,4,5,6,10),names_to="Disease",values_to="Cases") %>% filter(!is.na(Cases)) %>% group_by(Disease) %>% mutate(outlier_case=outlier(Cases)) %>%  summarize("# of disease observations"=n(),"total cases" =sum(Cases),mean=mean(Cases),"standard deviation"=sd(Cases),"standard error"=se(Cases),median=median(Cases),"# outliers"=sum(outlier_case=="outlier")) %>% mutate(Disease=str_replace_all(Disease,"yellow_fever","yellow fever")) %>% arrange(match(Disease,rows)) -> summary_disease
```

```{R}
peru_combination %>% rename("Annual CO2 emissions (tons)"="Annual CO2 emissions","Annual CO2 emissions (tons per capita)"="Annual CO2 emissions (per capita)","Annual CO2 emissions growth (tons)"="Annual CO2 emissions growth (abs)") %>% pivot_longer(7:9,names_to="CO2_metric",values_to="Value") %>% group_by(CO2_metric) %>% mutate(outlier_case=outlier(Value)) %>% summarize("# of observations"=n(),total=sum(Value),mean=mean(Value),"standard deviation"=sd(Value),"standard error"=se(Value),median=median(Value), "# outliers"=sum(outlier_case=="outlier")) %>% arrange(match(CO2_metric,rows_CO2)) %>% rename("CO2 metric"="CO2_metric")-> summary_co2
```

```{R}
peru_combination %>% select(-"Annual CO2 emissions (per capita)") %>% pivot_longer(6:8,names_to="co2_metric",values_to="values") %>% mutate(co2_metric=str_replace_all(co2_metric," |\\)|\\(","_")) %>% pivot_wider(names_from="co2_metric",values_from="values") %>% mutate(Year=decade(Year))%>%  group_by(Year) %>% mutate(n=n(),Annual_CO2_emissions=mean(Annual_CO2_emissions),Annual_CO2_emissions_growth__abs_=mean(Annual_CO2_emissions_growth__abs_)) %>% pivot_longer(2:6,names_to="type",values_to="cases") %>% mutate(type=type(type)) %>% group_by(Year,type) %>% summarize(annual_co2=mean(Annual_CO2_emissions),annual_co2_change=mean(Annual_CO2_emissions_growth__abs_),cases=sum(cases,na.rm=T),"# rows"=mean(n)) %>% ungroup() %>% pivot_wider(names_from="type",values_from="cases") %>% select("Year","# rows", everything()) %>% rename("decade"="Year","Mean Annual CO2 emissions (tons)"="annual_co2","Mean Annual CO2 emissions change (tons)"="annual_co2_change","total bacterial cases"="bacterial","total viral cases"="viral","total parasitic cases"="parasitic") %>% arrange(match(decade,decade_rows)) -> via_decade
```

```{R}
peru_combination %>% pivot_longer(2:6, names_to="disease", values_to="cases") %>% filter(!is.na(cases)) %>% mutate(century=century(Year),type=type(disease)) %>% group_by(century,type) %>% mutate(outlier=outlier(cases)) %>% summarize("# of disease observations"=n(),"total cases"=sum(cases,na.rm=T),mean=mean(cases),"standard deviation"=sd(cases),"standard error"=se(cases),median=median(cases),"# outliers"=sum(outlier=="outlier")) %>% rename("disease type"="type")-> disease_via_century
```
   
   
  The chunks of code above were used to make four datasets of summary statistics that could later be piped into the gt() function to make four neat tables. Details regarding the calculations that were performed are included underneath each table below. Still, I want to draw attention to the fact that this is where wrangling using 'dplyr' and 'stringr' functions occurred, as well as tidying using "pivot_longer" and "pivot_wider". 


```{R}
library(gt)

summary_disease %>% gt() %>% tab_header(title="Summary of Infectious Disease Data for Peru, 1970-2019") %>% tab_spanner(label="Summary Statistics",columns=c("Disease","# of disease observations","total cases","mean","standard deviation","standard error","median","# outliers")) %>% fmt_number(columns=c("mean", "standard deviation","standard error"),decimals=1,drop_trailing_dec_mark=T,use_seps=F) %>% tab_style(style=list(cell_text(align="center",size="small"),cell_fill(color="gray95")),locations=cells_body(columns="Disease")) %>% tab_style(style=list(cell_text(align="center",size="small"),cell_borders(sides="all",color="gray95")),locations=cells_body()) %>% tab_style(style=list(cell_fill(color="gray95"),cell_text(align="center",size="small",weight="bold",transform="uppercase"),cell_borders(sides="all",color="gray95")),locations=cells_column_labels(columns=c("Disease","# of disease observations","total cases","mean","standard deviation","standard error","median","# outliers"))) %>% tab_style(style=cell_text(style="italic"),locations=cells_column_spanners(spanners="Summary Statistics")) %>% tab_style(style=list(cell_text(weight="bold"),cell_fill(color="gray95")),locations=cells_title()) %>% cols_width(vars("# of disease observations","standard deviation")~px(100))
```  
    
     
  Prior to the creation of the table above, a new variable was created from the joined dataset that describes the number of total number cases of infectious disease (the sum of the five individual diseases) per year. Following this, summary statistics were calculated for the yearly cases of diphtheria, malaria, tetanus, measles, yellow fever, and all infectious disease. The summary statistics for each of these diseases include the amount of years for which there were observed cases, the total number of recorded cases over all years, the mean amount of cases per year, the standard deviation for the amount of cases per year, the standard error of the mean amount of cases per year, the median amount of cases per year, and the amount of years with outlier case numbers (as calculated by the previously-described "outlier()" function). One of the most interesting things about the resultant table is that the amount of malaria cases, as well as the mean and median amount of malaria cases, vastly outnumbers these same statistics for other individual diseases. As malaria is spread by infected mosquitoes that thrive in tropical climates near the equator, the high frequency of malaria cases in Peru from 1970 to 2019 can be expected. It's also worthwhile to note that for all of these diseases, the median number of cases was much less than the mean amount of cases, meaning that the data is likely skewed rightwards (there are a few years for which the number of cases was very high that alter the calculated mean). 
    
```{R}
summary_co2 %>% gt() %>% tab_header(title="Summary of CO2 Emissions for Peru, 1970-2019") %>% tab_spanner(label="Summary Statistics",columns=c("CO2 metric","# of observations","total","mean","standard deviation","standard error","median","# outliers")) %>% fmt_number(columns=c("total","mean", "standard deviation","standard error","median"),decimals=1,drop_trailing_dec_mark=T,use_seps=F) %>% tab_style(style=list(cell_text(align="center",size="small",transform="capitalize"),cell_fill(color="gray95")),locations=cells_body(columns="CO2 metric")) %>% tab_style(style=list(cell_text(align="center",size="small"),cell_borders(sides="all",color="gray95")),locations=cells_body()) %>% tab_style(style=list(cell_fill(color="gray95"),cell_text(align="center",size="small",weight="bold",transform="uppercase"),cell_borders(sides="all",color="gray95")),locations=cells_column_labels(columns=c("CO2 metric","# of observations","total","mean","standard deviation","standard error","median","# outliers"))) %>% tab_style(style=cell_text(style="italic"),locations=cells_column_spanners(spanners="Summary Statistics")) %>% tab_style(style=list(cell_text(weight="bold"),cell_fill(color="gray95")),locations=cells_title()) %>% cols_width(vars("standard deviation","CO2 metric")~px(90),vars("standard error")~px(70),vars("# of observations","# outliers")~px(60))
```  
  
    
  The table above details summary statistics for the three CO~2~ metrics included in the merged data set: the amount of CO~2~ emissions (tons) every year, the amount of CO~2~ emissions per capita (tons per capita) every year, and the change in CO~2~ emissions from the previous year (tons). Again, the statistics calculated for each of these three variables were the amount of years for which there is a recorded observation, the summed amount of the CO~2~ metric over all years, the mean of the CO~2~ metric measurements, the standard deviation of the CO~2~ metric measurements, the standard error of the mean CO~2~ metric measurement, the median of the CO~2~ metric measurements, and the amount of outlier observations per each metric (as calculated using my "outlier()" function). The most interesting thing that can be gleaned from the table is that, once again, the mean value for all of the CO~2~ metrics is larger than the corresponding median value. This means that,from 1970-2019 in Peru, there were certain years that saw extremely high amounts of CO~2~ emissions, emissions per capita, or changes in CO~2~ emissions from the following year for reasons that may become clear in future tables or graphs.

```{R}
via_decade %>% gt() %>% tab_header(title="Infectious Disease Cases and CO2 Emissions by Decade in Peru") %>% tab_spanner(label="Summary Statistics",columns=c("decade","# rows","Mean Annual CO2 emissions (tons)","Mean Annual CO2 emissions change (tons)","total bacterial cases","total viral cases","total parasitic cases")) %>%  tab_style(style=list(cell_text(align="center",size="small",transform="uppercase"),cell_fill(color="gray95")),locations=cells_body(columns="decade")) %>% tab_style(style=list(cell_text(align="center",size="small"),cell_borders(sides="all",color="gray95")),locations=cells_body()) %>% tab_style(style=list(cell_fill(color="gray95"),cell_text(align="center",size="small",weight="bold",transform="uppercase"),cell_borders(sides="all",color="gray95")),locations=cells_column_labels(columns=c("decade","# rows","Mean Annual CO2 emissions (tons)","Mean Annual CO2 emissions change (tons)","total bacterial cases","total viral cases","total parasitic cases"))) %>% tab_style(style=cell_text(style="italic"),locations=cells_column_spanners(spanners="Summary Statistics")) %>% tab_style(style=list(cell_text(weight="bold"),cell_fill(color="gray95")),locations=cells_title()) %>% cols_width(vars("Mean Annual CO2 emissions (tons)","Mean Annual CO2 emissions change (tons)")~px(140),vars("total viral cases","total parasitic cases","total bacterial cases","# rows")~px(70))
```  
    
  Prior to the creation of the table above, a new column was added to the merged dataset that took each value of "Year" and assigned it a decade (using the "decade()" that I made and described earlier). Additionally, I assigned each of the diseases as either "bacterial, "viral," or "parasitic" based on the microbial agent that causes the disease (with the aforementioned "type()" function). For each decade, the average amount of CO~2~ emissions (tons), the average change in CO~2~ emission, the total amount of bacterial diseases, the total amount of viral diseases, and the total amount of parasitic diseases were calculated. The most interesting thing about this table, to me, is that the average *change* in CO~2~ emissions from the previous year was negative in the '80s, even though the average emissions were higher in the '90s than they were in the '80s. This indicates to me that, for one or two years in the eighties, CO~2~ emissions dropped staggeringly but managed to recover. Though this may be overspeculative, I wonder if this may be due to the intense political instability of the era, in which implementation of a new constitution led to a decade of conflict between the central government, the moderate legacy of a military coup, and various Marxist or Maoist guerrilla groups, such as the infamous Shining Path.
  
```{R}
disease_via_century %>% gt() %>% tab_header(title="Summary of Infectious Disease Cases by Century") %>% tab_spanner(label="Summary Statistics",columns=c("disease type","# of disease observations","total cases","mean","standard deviation","standard error","median","# outliers")) %>% fmt_number(columns=c("mean", "standard deviation","standard error","median"),decimals=1,drop_trailing_dec_mark=T,use_seps=F) %>% tab_style(style=list(cell_text(align="center",size="small"),cell_borders(sides="all",color="gray95")),locations=cells_body()) %>% tab_style(style=list(cell_fill(color="gray95"),cell_text(align="center",size="small",weight="bold",transform="uppercase"),cell_borders(sides="all",color="gray95")),locations=cells_column_labels(columns=c("disease type","# of disease observations","total cases","mean","standard deviation","standard error","median","# outliers"))) %>% tab_style(style=cell_text(style="italic"),locations=cells_column_spanners(spanners="Summary Statistics")) %>% tab_style(style=list(cell_text(weight="bold"),cell_fill(color="gray95")),locations=cells_title()) %>% cols_width(vars("# of disease observations","standard deviation")~px(80)) %>% tab_style(style=cell_text(size="small",transform="uppercase",weight="bold"),locations=cells_row_groups())
```

  This final table was generated in order to provide summary statistics for two grouped categorical variables. Prior to calculating any statistics, two changes were made to merged dataset: each value of "Year" variable was assigned as either "twentieth century" or "twenty-first" century using the "century()" function that I created, and each of the diseases were assigned as either "bacterial," "viral," or "parasitic" based on the microbial agent that causes the disease. Following this, these two categorical variables were grouped together, and statistics were calculated for counts of disease cases. The summary statistics included icn here are the amount of observations per century and disease type, the total amount of cases for each disease type and century, the mean amount of cases for each disease type and century, the standard deviation of cases by disease type and century, the standard error of the mean amount of cases by disease type and century, and the amount of outlier cases per combination of century and disease type. The most interesting in this table, to me, is that the levels of bacterial and viral disease were much lower in the twenty-first century than they were in the twentieth century, but the levels for parasitic disease did not change as much. This tells me that, over the course of years, Peru has improved health and sanitation conditions to an extent where bacteria and viruses are not as abundant, but have not been as successful in controlling the amount of malaria-vector mosquitoes, as malaria is the only parasitic disease included in this data.

### Visualizing

```{R}
peru_combination %>% pivot_longer(2:6,names_to="Disease",values_to="Cases") %>% mutate(Disease=str_replace_all(Disease,"_"," ")) %>% rename("Annual CO2 emissions (tons)"="Annual CO2 emissions","Annual CO2 emissions (tons per capita)"="Annual CO2 emissions (per capita)","Annual CO2 emissions growth (tons)"="Annual CO2 emissions growth (abs)") %>% pivot_longer(2:4,names_to="CO2_Metric",values_to="Tons") %>% filter(CO2_Metric=="Annual CO2 emissions (tons per capita)") %>% ggplot(aes(x=Cases,y=Tons,color=Disease)) +geom_point() +theme_light() +facet_grid(Disease~.,scales="free_y") +scale_x_log10(labels=scales::number) +geom_smooth(aes(color=Disease),method="lm",se=F) +theme(legend.position="none") +ggtitle("Infectious Disease Cases Plotted Against Annual CO2 Emissions for Peru","Each plot corresponds to a different infectious disease, listed on the right side.") +ylab("Emissions (tons)") +scale_color_brewer(palette="Dark2")
```

  The scatterplot above shows the (log~10~-transformed) cases of infectious disease for a year plotted against the matching annual CO~2~ emission (tons), with the plot being faceted according to the specific infectious disease. As I mentioned previously, I expected there to be a slight inverse relationship between cases of infectious disease and CO~2~ emissions. This inverse relationship exists, even if slightly, for all diseases but diphtheria. Of course, a huge caveat to this is that there are many years that demonstrated zero diphtheria or malaria cases, and the years for which zero cases exist demonstrated a wide range of CO~2~ emissions. 
On top of this, it's important to note that the x-axis, plotting disease cases, is logarithmically transformed to accommodate for the much larger amount of malaria cases, which may also impact the veracity of the pictured association. For these reasons, while the expected association between the variables appears to exist, it is a very dubious association.  
  
```{R}
peru_combination %>% pivot_longer(2:6,names_to="Disease",values_to="Cases") %>% mutate(Disease=str_replace_all(Disease,"_"," ")) %>% mutate(Decade=decade(Year)) %>% ggplot(aes(x=Disease,y=Cases)) +geom_bar(aes(color=Disease),stat="summary",fun="mean",alpha=0.75,fill="white") +geom_jitter(aes(shape=Decade,color=Disease),alpha=0.9) +geom_errorbar(stat="summary",width=0.25) +scale_y_log10(labels=scales::number,n.breaks=7) +scale_color_brewer(palette="Dark2") +theme_light() +ggtitle("Mean and Distribution for Number of Cases per Each Infectious Disease", "Included in the figure are error bars indicating mean plus or minus standard error.  
Distribution also distinguished by decade for each case number.") +theme(plot.title=element_text(size=14),plot.subtitle=element_text(color="gray30"),legend.text=element_text(size=10))
```

  While addressing a previous table on this page, I mentioned that the data for number of disease cases is likely skewed rightward, resulting in a higher mean number of cases than median number of cases. The figure above is meant to better represent how this discrepancy occurs. For example, when looking at the data specific to diphtheria, there are some years with high case numbers and much more years with a case number of zero. When the mean case number is calculated for diphtheria, the higher case number takes on an undue magnitude of influence in the final output. On the other hand, the magnitude of higher values is not taken into account when the median amount of cases is calculated making it a better metric to represent the center value of data. One other thing that I'd like to note is that for many diseases (specifically diphtheria, measles, and tetanus), the points corresponding to a large amount of cases primarily were most often from the seventies, eighties, or nineties. The small amount of cases for certain infectious diseases in recent years is likely the result of increased vaccine availability and improved healthcare access. Finally, it is again important to note that a logarithmic scale has been used to transform the y-axis in order to display the data more clearly; this transformation likely has some effect on how the figure is interpreted or if it is interpreted accurately.

```{R}
peru_combination %>% group_by(Year) %>% rename("Annual CO2 Emissions Change (tons)"="Annual CO2 emissions growth (abs)") %>% pivot_longer(c(2:6,9),names_to="Thing",values_to="Value") %>% mutate(Thing=str_replace_all(Thing,"diphtheria|malaria|tetanus|measles|yellow_fever","Mean # of Disease Cases")) %>% ggplot(aes(x=Year)) +geom_errorbar(aes(y=Value,group=Year),stat="summary",alpha=0.3) +geom_point(aes(y=Value,group=Year),stat="summary",fun="mean",alpha=0.8,size=2,col="red") +geom_line(aes(y=Value),stat="summary",fun="mean",alpha=0.8,col="red") +facet_wrap(.~Thing,scales="free_y",switch="y") +scale_y_continuous(labels=scales::number) +theme_light() +theme(axis.title.y = element_blank(),plot.title=element_text(size=12),plot.title.position="plot",plot.subtitle=element_text(color="gray50")) +ggtitle("Amount of Infectious Disease Cases and Change in CO2 Emissions over 30 Years","The graph on the left represents the change in CO2 emissions from the previous year (in tons).  
The graph on the right reflects the mean amount of total infectious disease cases per year with error  
bars.")
```

  The purpose of the graphs above were to see if there was any correlation between annual change in CO~2~ levels per year and the average number of infectious disease cases per year. While these two graphs are not similar in appearance, I do find it interesting that the mean number of infectious disease cases rises dramatically in the 1990s, as the magnitude of CO~2~ change during this time was fairly small when compared to other decades. Again, these two curiosities may be attributable to Peru's political history, as the 1990s marked the presidential years of Alberto Fujimori, the man responsible for dramatically expanding free enterprise and neoliberalism in the country. The uptick in disease cases during this time period may be an effect of the population needing to adjust, if they could, to increased healthcare privatization while the small increases in CO~2~ emissions may have been produced by a period of stagnancy as nationalized industries became privately-owned. Still, it must be recognized that the error bars on the rightward graph are fairly large, meaning that interpreting infectious disease rates as high during the '90s may be flawed in and of itself. And of course, my political explanations for certain trends are pure speculation.
  
### Concluding Remarks
 
  From my previous paragraphs, it may be obvious that CO~2~ emissions were not necessarily a topic I was interested in exploring. In fact, the original intent of this project was to measure the amount of infectious disease cases per year in relation to the political situation of Peru at that time. The history of Peruvian politics is super interesting to me because it is so extreme in comparison to American politics. For example, seven Peruvian presidents of the past twenty years are either currently in jail, awaiting extradition, awaiting trial, killed themselves to avoid being tried for corruption, or were forced to resign due to claims of corruption (via impeachment or protests) (9). In trying to find infectious disease data, I noticed some gaps in disease reporting during very tense or shaky political situations, and I thought this would be interesting to explore. The problem I had, however, is that there aren't readily-available or easily-interpretable data sets for Peruvian politics, especially none that span 50 years.  
  
  On top of this, the infectious disease data I collected doesn't give a comprehensive overview of infectious disease in Peru because there are many other infectious diseases that affect Peru besides the 5 chosen by me. For example, tuberculosis is a big problem in Peru and has been for many years (10). While there are existent tuberculosis data sets for Peru, the way that tuberculosis is reported (per 100,00 people, differentiated by the affected organ system) does not really match with how other infectious diseases are reported (total number of cases) and, for that reason, felt inappropriate to include. Even though there was little interesting association between CO~2~ emissions (as a metric of energy usage) and the amount of infectious disease cases in Peru, I still found the data I collected for these two topics interesting because both demonstrated year- or decade-specific trends that could not be easily explained by themselves. In the future, it would be great to find more long-term data that I could add to this analysis so as to fully elucidate the potential reasons for outbreaks of infectious disease in Peru.  
  
  I would like to end this investigation by sharing the "Receta Para La Felicidad," or the recipe for happiness, according to the Peruvian Ministry of Health in the year 2000, because I find the use of WordArt and comic sans in a government document to be kind of funny (11).

![](https://pbs.twimg.com/media/FDJe2MuWYAQ6IAT?format=jpg&name=large)


### Works Cited

1.  Abd, R. (2020, October 23). In hard-hit Peru, worry mounts over both COVID-19 and dengue. *Associated Press*. https://apnews.com/article/pandemics-virus-outbreak-health-latin-america-peru-6f5863d1f9b53abae123dc480bf65dbf  

2.  World Health Organization. (2021). *Diphtheria - number of reported cases* [Data Set]. World Health Organization. https://www.who.int/data/gho/data/indicators/indicator-details/GHO/diphtheria---number-of-reported-cases  

3.  World Health Organization. (2021). *Yellow fever - number of reported cases* [Data Set]. World Health Organization. https://www.who.int/data/gho/data/indicators/indicator-details/GHO/yellow-fever---number-of-reported-cases  

4.  World Health Organization. (2021). *Total tetanus - number of reported cases* [Data Set]. World Health Organiztion. https://www.who.int/data/gho/data/indicators/indicator-details/GHO/total-tetanus---number-of-reported-cases

5.  World Health Organization. (2021). *Measles - number of reported cases* [Data Set]. World Health Organization. https://www.who.int/data/gho/data/indicators/indicator-details/GHO/measles---number-of-reported-cases

6.  Pan American Health Organization & World Health Organization. (2021). *Malaria Surveillance Indicators* [Data Set]. Pan American Health Organization. https://www3.paho.org/data/index.php/en/mnu-topics/indicadores-malaria-en.html

7.  Ministerio de Salud Perú: Oficina de Informatica. (1977). *Informe Estadístico: Enfermedades Transmisibles Perú: 1976*. https://cdn.www.gob.pe/uploads/document/file/417103/39960424564800618020191106-32001-mrbl52.pdf

8.  Ritchie, H. &, Roser, M. (2020). *Peru: CO2 Country Profile* [Data Set]. Our World In Data. https://ourworldindata.org/co2/country/peru#citation

9.  Martinic, M. S. (2020, November 17). The curious case of Peru’s persistent president-to-prison politics: Is Peru on a sanctimonious streak out to root out corruption? *The Week Magazine*. https://www.theweek.in/news/world/2020/11/17/the-curious-case-of-perus-persistent-president-to-prison-politics.html

10.  Ministerio de Salud Perú: Dirección General de Servicios de Salud (1982). *Situación de la tuberculosis en el Perú*. https://cdn.www.gob.pe/uploads/document/file/389908/Situaci%C3%B3n_de_la_tuberculosis_en_el_Per%C3%BA20191016-26158-1ysoz2l.pdf

11. Organo de Salud del Niño: Órgano Desconcentrado y Especializado del Ministerio de Salud Perú (2000). *Compendio Estadístico 1999*. https://cdn.www.gob.pe/uploads/document/file/419120/4713-220191107-32001-1qj5eph.pdf
